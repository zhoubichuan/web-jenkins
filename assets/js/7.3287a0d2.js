(window.webpackJsonp=window.webpackJsonp||[]).push([[7],{505:function(s,a,t){s.exports=t.p+"assets/img/1.1.abd04bb6.png"},506:function(s,a,t){s.exports=t.p+"assets/img/1.2.563ced0d.png"},519:function(s,a,t){"use strict";t.r(a);var n=t(29),e=Object(n.a)({},(function(){var s=this,a=s.$createElement,n=s._self._c||a;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("h1",{attrs:{id:"jenkins-基础"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#jenkins-基础"}},[s._v("#")]),s._v(" Jenkins 基础")]),s._v(" "),n("h2",{attrs:{id:"_1-持续集成"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-持续集成"}},[s._v("#")]),s._v(" 1. 持续集成")]),s._v(" "),n("ul",[n("li",[s._v("持续集成（ci）代码合并、构建、部署、测试在一起，不断执行这个过程对结果进行反馈")]),s._v(" "),n("li",[s._v("持续部署（cd）部署到生产环境")]),s._v(" "),n("li",[s._v("持续交付（cd）部署到生产环境，给用户使用")]),s._v(" "),n("li",[s._v("DevOps 是一个完整的面向 IT 运维的工作流，以 IT 自动化以及持续集成（ci）、持续部署（cd）为基础，来优化程序开发、测试、系统运维等所有环节\nhttp://img.zhufengpeixun.cn/cicd.jpg")])]),s._v(" "),n("h2",{attrs:{id:"_2-jenkins"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-jenkins"}},[s._v("#")]),s._v(" 2. Jenkins")]),s._v(" "),n("p",[n("img",{attrs:{src:t(505),alt:""}}),s._v(" "),n("img",{attrs:{src:t(506),alt:""}})]),s._v(" "),n("h2",{attrs:{id:"_3-git-安装"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-git-安装"}},[s._v("#")]),s._v(" 3. Git 安装")]),s._v(" "),n("h3",{attrs:{id:"_3-1-git-服务器"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-git-服务器"}},[s._v("#")]),s._v(" 3.1 git 服务器")]),s._v(" "),n("h4",{attrs:{id:"_3-1-1-安装-git"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-1-安装-git"}},[s._v("#")]),s._v(" 3.1.1 安装 git")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("yum isntall -y "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("h4",{attrs:{id:"_3-1-2-创建-git-用户"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-2-创建-git-用户"}},[s._v("#")]),s._v(" 3.1.2 创建 git 用户")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[s._v("useradd")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("passwd")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])]),n("h4",{attrs:{id:"_3-1-3-创建仓库"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-3-创建仓库"}},[s._v("#")]),s._v(" 3.1.3 创建仓库")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[s._v("su")]),s._v(" - "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" -p ~/repos/app.git\n"),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" ~/repos/app.git\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" --bare init\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br")])]),n("h3",{attrs:{id:"_3-2-git-客户端-web-服务器"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-git-客户端-web-服务器"}},[s._v("#")]),s._v(" 3.2 git 客户端（web 服务器）")]),s._v(" "),n("h4",{attrs:{id:"_3-2-1-安装-git"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-1-安装-git"}},[s._v("#")]),s._v(" 3.2.1 安装 git")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("yum "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" -y "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /usr/local/src\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" clone git@"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("你的ip"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(":/home/git/repos/app.git\n"),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" app\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" config --global user.email "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'zhoubichuan@icloud.com'")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" config --global user.name "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'zhoubichuan'")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("touch")]),s._v(" index.html\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("add")]),s._v(" -A\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" commit -m "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'init'")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" push origin master\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br")])]),n("h4",{attrs:{id:"免密码登陆"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#免密码登陆"}},[s._v("#")]),s._v(" 免密码登陆")]),s._v(" "),n("p",[n("strong",[s._v("生成密钥")])]),s._v(" "),n("ul",[n("li",[s._v("先登陆 web 服务器生成密钥并拷贝公钥")])]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("ssh-keygen -t rsa\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" ~/.ssh/id_rsa.pub\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])]),n("p",[n("strong",[s._v("拷贝公钥")])]),s._v(" "),n("ul",[n("li",[s._v("再登录 git 服务器")]),s._v(" "),n("li",[s._v("要注意如果你要免登录 git 用户，就需要把自己的公钥拷贝到 git 用户的 authorized_keys 文件里")])]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("ssh-keygen -t rsa\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("700")]),s._v(" /home/git/.ssh\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("vi")]),s._v(" /home/git/.ssh/authorized_keys\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("600")]),s._v(" /home/git/.ssh/authorized_keys\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br")])]),n("p",[n("strong",[s._v("允许公钥登录")])]),s._v(" "),n("ul",[n("li",[s._v("再登录 git 服务器")]),s._v(" "),n("li",[s._v("vim /etc/ssh/sshd_config")])]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("PubkeyAuthentication "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("yes")]),s._v("\nsystemctl restart sshd\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])]),n("h2",{attrs:{id:"_4-jenkins"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_4-jenkins"}},[s._v("#")]),s._v(" 4. Jenkins")]),s._v(" "),n("ul",[n("li",[s._v("jdk")]),s._v(" "),n("li",[s._v("jenkins 官网")])]),s._v(" "),n("h3",{attrs:{id:"_4-1-安装-jdk"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_4-1-安装-jdk"}},[s._v("#")]),s._v(" 4.1 安装 JDK")]),s._v(" "),n("ul",[n("li",[s._v("jdk")])]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /usr/local/src\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v(" http://img.zhufengpeixun.cn/jdk1.8.0_211.tar.gz\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("tar")]),s._v(" -xzvf jdk1.8.0_211.tar.gz\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" -r /usr/local/src/jdk1.8.0_211 /usr/java\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" -rf /usr/bin/java　"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v("　"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("ln")]),s._v(" -s /usr/java/jdk1.8.0_211/bin/java /usr/bin/java\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])]),n("h3",{attrs:{id:"_4-2-修改配置文件"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_4-2-修改配置文件"}},[s._v("#")]),s._v(" 4.2 修改配置文件")]),s._v(" "),n("p",[s._v("vi /etc/profile")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("JAVA_HOME")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/usr/java/jdk1.8.0_211\n"),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("CLASSPATH")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(".:"),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${JAVA_HOME}")]),s._v("/jre/lib/rt.jar:"),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${JAVA_HOME}")]),s._v("/lib/dt.jar:"),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${JAVA_HOME}")]),s._v("/lib/tools.jar\n"),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[n("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("PATH")])]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("$PATH")]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${JAVA_HOME}")]),s._v("/bin\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("h3",{attrs:{id:"_4-3-生效配置"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_4-3-生效配置"}},[s._v("#")]),s._v(" 4.3 生效配置")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("source")]),s._v(" /etc/profile\njava --version\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])]),n("h3",{attrs:{id:"_4-4-安装-jenkins"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_4-4-安装-jenkins"}},[s._v("#")]),s._v(" 4.4 安装 jenkins")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v(" -O /etc/yum.repos.d/jenkins.repo https://pkg.jenkins.io/redhat-stable/jenkins.repo\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("rpm")]),s._v(" --import https://pkg.jenkins.io/redhat-stable/jenkins.io.key\nyum "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" -y jenkins\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("h3",{attrs:{id:"_4-5-关闭防火墙"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_4-5-关闭防火墙"}},[s._v("#")]),s._v(" 4.5 关闭防火墙")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("systemctl stop firewalld.service\nsystemctl disable firewalld.service\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])]),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("javap -v JNLPMain.class\nJ2SE "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("52")]),s._v("\nJ2SE "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("51")]),s._v("\nJ2SE "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("6.0")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("50")]),s._v("\nJ2SE "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("5.0")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("49")]),s._v("\nJDK "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.4")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("48")]),s._v("\nJDK "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.3")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("47")]),s._v("\nJDK "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.2")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("46")]),s._v("\nJDK "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.1")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("45")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br")])]),n("h3",{attrs:{id:"_4-6-启动-jenkins"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_4-6-启动-jenkins"}},[s._v("#")]),s._v(" 4.6 启动 jenkins")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("systemctl start jenkins\nsystemctl daemon-reload\nsystemctl status jenkins\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("h3",{attrs:{id:"_4-7-选择-java-版本"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_4-7-选择-java-版本"}},[s._v("#")]),s._v(" 4.7 选择 java 版本")]),s._v(" "),n("p",[s._v("vi /etc/init.d/jenkins")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("candidates")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"\n#/etc/alternatives/java\n#/usr/lib/jvm/java-1.8.0/bin/java\n#/usr/lib/jvm/jre-1.8.0/bin/java\n#/usr/lib/jvm/java-1.7.0/bin/java\n#/usr/lib/jvm/jre-1.7.0/bin/java\n/usr/bin/java\n"')]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br")])]),n("h3",{attrs:{id:"_4-8-运行用户"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_4-8-运行用户"}},[s._v("#")]),s._v(" 4.8 运行用户")]),s._v(" "),n("p",[s._v("一定要改一下 root 用户，不然流水线 SCM 拉不到脚本 vi /etc/sysconfig/jenkins")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("JENKINS_USER")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"root"')]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("h3",{attrs:{id:"_4-8-访问-jenkins"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_4-8-访问-jenkins"}},[s._v("#")]),s._v(" 4.8 访问 jenkins")]),s._v(" "),n("p",[s._v("http://192.168.20.133:8080")]),s._v(" "),n("h3",{attrs:{id:"_4-9-安装-maven"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_4-9-安装-maven"}},[s._v("#")]),s._v(" 4.9 安装 maven")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("yum "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" maven -y\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# rpm -ql maven")]),s._v("\n\n/etc/m2.conf\n/etc/maven\n/etc/maven/settings.xml\n/usr/bin/mvn\n/usr/share/maven/conf/settings.xml\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br")])]),n("h3",{attrs:{id:"_4-10-使用-jenkins"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_4-10-使用-jenkins"}},[s._v("#")]),s._v(" 4.10 使用 jenkins")]),s._v(" "),n("ul",[n("li",[s._v("jenkins")]),s._v(" "),n("li",[s._v("OWASP(Open Web Application Security Project),开放式 Web 应用程序安全项目,它识别项目依赖关系，并检查是否存在任何已知的和公开的漏洞.")]),s._v(" "),n("li",[s._v("PAM（Pluggable Authentication Modules ）是由 Sun 提出的一种认证机制。它通过提供一些动态链接库和一套统一的 API，将系统提供的服务和该服务的认证方式分开，使得系统管理员可以灵活地根据需要给不同的服务配置不同的认证方式而无需更改服务程序，同时也便于向系统中添加新的认证手段。 PAM 模块是一种嵌入式模块，修改后即时生效。")]),s._v(" "),n("li",[s._v("LDAP（Light Directory Access Portocol）,它是基于 X.500 标准的轻量级目录访问协议")])]),s._v(" "),n("table",[n("thead",[n("tr",[n("th",[s._v("插件名称")]),s._v(" "),n("th",[s._v("插件作用")])])]),s._v(" "),n("tbody",[n("tr",[n("td",[s._v("Folders")]),s._v(" "),n("td",[s._v("(https://plugins.jenkins.io/cloudbees-folder),这个插件支持用户使用目录管理项目，目录支持嵌套，并且支持目录中创建视图")])]),s._v(" "),n("tr",[n("td",[s._v("OWASP Markup Formatter")]),s._v(" "),n("td",[s._v("OWASP 标记格式化程序插件,使用 OWASP Java HTML Sanitizer ，可以在项目描述等中输入安全的 HTML 标记")])]),s._v(" "),n("tr",[n("td",[s._v("Build Timeout")]),s._v(" "),n("td",[s._v("构建超时,此插件允许构建在指定的时间过后自动终止")])]),s._v(" "),n("tr",[n("td",[s._v("Credentials Binding")]),s._v(" "),n("td",[s._v("证书绑定")])]),s._v(" "),n("tr",[n("td",[s._v("Timestamper")]),s._v(" "),n("td",[s._v("将时间戳添加到控制台输出")])]),s._v(" "),n("tr",[n("td",[s._v("Workspace Cleanup")]),s._v(" "),n("td",[s._v("(https://plugins.jenkins.io/ws-cleanup),这个插件支持在构建前后 删除或者部分删除 workspace")])]),s._v(" "),n("tr",[n("td",[s._v("Ant")]),s._v(" "),n("td",[s._v("向 Jenkins 添加 Apache Ant 支持")])]),s._v(" "),n("tr",[n("td",[s._v("Gradle")]),s._v(" "),n("td",[s._v("这个插件允许 Jenkins 直接调用 Gradle 构建脚本")])]),s._v(" "),n("tr",[n("td",[s._v("Pipeline")]),s._v(" "),n("td",[s._v("管道,一套插件可让您协调自动化")])]),s._v(" "),n("tr",[n("td",[s._v("Pipeline: GitHub Groovy Libraries")]),s._v(" "),n("td",[s._v("允许从 GitHub 动态加载 Pipeline Groovy 库")])]),s._v(" "),n("tr",[n("td",[s._v("Pipeline: Stage View")]),s._v(" "),n("td",[s._v("查看每一步的执行结果")])]),s._v(" "),n("tr",[n("td",[s._v("GitHub Branch Source")]),s._v(" "),n("td",[s._v("GitHub 组织文件夹插件")])]),s._v(" "),n("tr",[n("td",[s._v("Git")]),s._v(" "),n("td",[s._v("(https://plugins.jenkins.io/git),支持使用 Github、GitLab、Gerrit 等系统管理代码仓库")])]),s._v(" "),n("tr",[n("td",[s._v("Subversion")]),s._v(" "),n("td",[s._v("(https://plugins.jenkins.io/subversion),支持 Subversion 系统管理源代码")])]),s._v(" "),n("tr",[n("td",[s._v("SSH Slaves")]),s._v(" "),n("td",[s._v("SSH 登录到一个远程服务器以执行必要的脚本")])]),s._v(" "),n("tr",[n("td",[s._v("Matrix Authorization Strategy")]),s._v(" "),n("td",[s._v("矩阵授权策略插件,提供基于矩阵的安全授权策略（全局和每个项目）")])]),s._v(" "),n("tr",[n("td",[s._v("PAM Authentication")]),s._v(" "),n("td",[s._v("为 Jenkins 添加 Unix 可插入身份验证模块（PAM）支持")])]),s._v(" "),n("tr",[n("td",[s._v("LDAP")]),s._v(" "),n("td",[s._v("(https://plugins.jenkins.io/ldap),这个插件允许使用 LDAP 对用户进行认证，LDAP 服务器可以为 Active Directory 或者 OpenLDAP")])]),s._v(" "),n("tr",[n("td",[s._v("Email Extension")]),s._v(" "),n("td",[s._v("这个插件是 Jenkins 的电子邮件发布者的替代品。它允许配置电子邮件通知的各个方面：发送电子邮件时，应该收到谁以及电子邮件说明的内容")])]),s._v(" "),n("tr",[n("td",[s._v("Mailer")]),s._v(" "),n("td",[s._v("发邮件服务")])]),s._v(" "),n("tr",[n("td",[s._v("Localization: Chinese (Simplified)")]),s._v(" "),n("td",[s._v("本地化构建")])])])]),s._v(" "),n("h3",{attrs:{id:"_4-11-下载插件加速"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_4-11-下载插件加速"}},[s._v("#")]),s._v(" 4.11 下载插件加速")]),s._v(" "),n("ul",[n("li",[s._v("mirrors")]),s._v(" "),n("li",[s._v("update-center")])]),s._v(" "),n("h3",{attrs:{id:"_4-12-创建管理员用户"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_4-12-创建管理员用户"}},[s._v("#")]),s._v(" 4.12 创建管理员用户")]),s._v(" "),n("h3",{attrs:{id:"_4-13-主要功能"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_4-13-主要功能"}},[s._v("#")]),s._v(" 4.13 主要功能")]),s._v(" "),n("ul",[n("li",[s._v("新建任务")]),s._v(" "),n("li",[s._v("用户")]),s._v(" "),n("li",[s._v("构建历史")]),s._v(" "),n("li",[s._v("系统管理")]),s._v(" "),n("li",[s._v("我的视图")]),s._v(" "),n("li",[s._v("Credentials")]),s._v(" "),n("li",[s._v("新建视图")])]),s._v(" "),n("h3",{attrs:{id:"_5-角色和用户管理"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_5-角色和用户管理"}},[s._v("#")]),s._v(" 5. 角色和用户管理")]),s._v(" "),n("ul",[n("li",[n("p",[s._v("安装 Role-based Authorization Strategy 插件")])]),s._v(" "),n("li",[n("p",[s._v("manageroles")])]),s._v(" "),n("li",[n("p",[s._v("assignusers")])]),s._v(" "),n("li",[n("p",[s._v("jprojects")])])]),s._v(" "),n("h2",{attrs:{id:"_6-参数化构建"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_6-参数化构建"}},[s._v("#")]),s._v(" 6. 参数化构建")]),s._v(" "),n("ul",[n("li",[n("p",[s._v("Extended Choice Parameter 插件")])]),s._v(" "),n("li",[n("p",[s._v("Git Parameter 插件")])]),s._v(" "),n("li",[n("p",[s._v("parameterbuild")])]),s._v(" "),n("li",[n("p",[s._v("execshell")])]),s._v(" "),n("li",[n("p",[s._v("extendparameterbuild")])]),s._v(" "),n("li",[n("p",[s._v("buildspec")])])]),s._v(" "),n("p",[s._v("vi /etc/sysconfig/jenkins 一定要改一下 root 用户，不然流水线 SCM 拉不到脚本")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("JENKINS_USER")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"root"')]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" branch "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("test")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" checkout "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("test")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" branch\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("touch")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(".txt\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("add")]),s._v(" -A\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" commit -m"),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"add 5.txt"')]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" push origin "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("test")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" push origin "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("test")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br")])]),n("h2",{attrs:{id:"_7-主从模式"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_7-主从模式"}},[s._v("#")]),s._v(" 7. 主从模式")]),s._v(" "),n("ul",[n("li",[n("p",[s._v("masterslave2")])]),s._v(" "),n("li",[n("p",[s._v("configureslave")])]),s._v(" "),n("li",[n("p",[s._v("limitproject")])]),s._v(" "),n("li",[n("p",[s._v("configslave2")])])]),s._v(" "),n("h2",{attrs:{id:"_8-流水线"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_8-流水线"}},[s._v("#")]),s._v(" 8. 流水线")]),s._v(" "),n("ul",[n("li",[n("p",[s._v("Pipeline 插件\nmystageview")])]),s._v(" "),n("li",[n("p",[s._v("pipelinegrammar")])])]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[s._v("node")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    stage "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'checkout'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n       "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"checkout"')]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    stage "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'build'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"build"')]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    stage "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'deploy'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"deploy"')]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    stage "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'test'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"test"')]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br")])]),n("ul",[n("li",[s._v("scmscript")])]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("node"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'slave'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    stage "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'checkout'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n       "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"checkout2"')]),s._v("\n       "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sleep")]),s._v(" time: "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(", unit: "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'SECONDS'")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    stage "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'build'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"build"')]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    stage "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'deploy'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"deploy"')]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    stage "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'test'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"test"')]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br")])]),n("h2",{attrs:{id:"_9-邮件通知"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_9-邮件通知"}},[s._v("#")]),s._v(" 9. 邮件通知")]),s._v(" "),n("ul",[n("li",[s._v("Email Extension Plugin 插件")])]),s._v(" "),n("h2",{attrs:{id:"_10-发布-php-项目"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_10-发布-php-项目"}},[s._v("#")]),s._v(" 10. 发布 PHP 项目")]),s._v(" "),n("h3",{attrs:{id:"_10-1-创建本地项目"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_10-1-创建本地项目"}},[s._v("#")]),s._v(" 10.1 创建本地项目")]),s._v(" "),n("ul",[n("li",[s._v("先登录 git 服务器创建 php 仓库")])]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" -p /home/git/repos/dev-php.git\n"),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /home/git/repos/dev-php.git\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" init --bare\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("h3",{attrs:{id:"_10-2-拉取代码"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_10-2-拉取代码"}},[s._v("#")]),s._v(" 10.2 拉取代码")]),s._v(" "),n("ul",[n("li",[s._v("拉取并初始化本地仓库")])]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" clone  git@192.168.20.131:/home/git/repos/dev-php.git\n"),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" php\n"),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"<?php echo info()?>"')]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" index.php\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("add")]),s._v(" -A\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" commit -m"),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"add index.php"')]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" push origin master\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br")])]),n("h3",{attrs:{id:"_10-3-部署环境"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_10-3-部署环境"}},[s._v("#")]),s._v(" 10.3 部署环境")]),s._v(" "),n("ul",[n("li",[s._v("安装 php")]),s._v(" "),n("li",[s._v("安装 Jenkins")])]),s._v(" "),n("h3",{attrs:{id:"_10-4-创建项目"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_10-4-创建项目"}},[s._v("#")]),s._v(" 10.4 创建项目")]),s._v(" "),n("h4",{attrs:{id:"_10-4-1-构建参数"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_10-4-1-构建参数"}},[s._v("#")]),s._v(" 10.4.1 构建参数")]),s._v(" "),n("p",[s._v("constphp")]),s._v(" "),n("p",[s._v("phppipeline")]),s._v(" "),n("h4",{attrs:{id:"_10-4-2-pipeline-脚本"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_10-4-2-pipeline-脚本"}},[s._v("#")]),s._v(" 10.4.2 pipeline 脚本")]),s._v(" "),n("ul",[n("li",[n("p",[s._v("先在 git 服务器里创建一个 dev-php 项目")])]),s._v(" "),n("li",[n("p",[s._v("然后到 web 服务器上克隆此项目并在里面添加文件")])]),s._v(" "),n("li",[n("p",[s._v("在 pipeline 服务器里添加新的脚本")])]),s._v(" "),n("li",[n("p",[s._v("给 web 服务器添加标签名并在 pipeline 脚本中引用")])]),s._v(" "),n("li",[n("p",[s._v("web 服务器上的工作目录 /var/lib/jenkins/workspace/dev-php")])]),s._v(" "),n("li",[n("p",[s._v("credentialsId git/git\ncat /root/pipeline/Jenkinsfile-php")])])]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("node"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'webserver'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    stage "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'checkout'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n       checkout"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$class")]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'GitSCM'")]),s._v(", branches: "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("name: "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'*/master'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(", doGenerateSubmoduleConfigurations: false, extensions: "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(", submoduleCfg: "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(", userRemoteConfigs: "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("credentialsId: "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'8e8e63f9-4806-4f2e-8633-c92badbdefd7'")]),s._v(", url: "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"git@192.168.20.131:/home/git/repos/'),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${JOB_NAME}")]),s._v('.git"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    stage "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'build'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n       "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sh")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("''")]),s._v("'rm -rf "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${WORKSPACE}")]),s._v("/.git\n       "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" -e /data/backup "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" -p /data/backup\n       "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" -e /usr/share/Jenkins/html/"),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${JOB_NAME}")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" /usr/share/Jenkins/html/"),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${JOB_NAME}")]),s._v("\n       "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("mv")]),s._v(" /usr/share/Jenkins/html/"),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${JOB_NAME}")]),s._v(" /data/backup/"),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${JOB_NAME}")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-'),n("span",{pre:!0,attrs:{class:"token variable"}},[n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("date")]),s._v(" +%F_%T"),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v('"')]),s._v("\n       "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" -rf "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${WORKSPACE}")]),s._v(" /usr/share/Jenkins/html"),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("''")]),s._v("'\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    stage "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'test'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sh")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"curl http://www.'),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${JOB_NAME}")]),s._v('.com/status"')]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br")])]),n("h2",{attrs:{id:"_11-发布-java-项目"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_11-发布-java-项目"}},[s._v("#")]),s._v(" 11. 发布 Java 项目")]),s._v(" "),n("h3",{attrs:{id:"_11-1-创建本地项目"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_11-1-创建本地项目"}},[s._v("#")]),s._v(" 11.1 创建本地项目")]),s._v(" "),n("ul",[n("li",[s._v("先登录 git 服务器创建 java 仓库")])]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" -p /home/git/repos/dev-java.git\n"),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /home/git/repos/dev-java.git\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" init --bare\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("h3",{attrs:{id:"_10-2-拉取代码-2"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_10-2-拉取代码-2"}},[s._v("#")]),s._v(" 10.2 拉取代码")]),s._v(" "),n("p",[s._v("拉取并初始化本地仓库")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" clone git@github.com:zhufengnodejs/blog2.git\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" clone git@192.168.20.131:/home/git/repos/dev-java.git\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("add")]),s._v(" -A "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" commit -m"),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"blog2"')]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" push origin master\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("h3",{attrs:{id:"_10-3-部署环境-2"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_10-3-部署环境-2"}},[s._v("#")]),s._v(" 10.3 部署环境")]),s._v(" "),n("ul",[n("li",[s._v("jdk")]),s._v(" "),n("li",[s._v("maven")]),s._v(" "),n("li",[s._v("tomcat")])]),s._v(" "),n("h3",{attrs:{id:"_10-4-pipeline-脚本"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_10-4-pipeline-脚本"}},[s._v("#")]),s._v(" 10.4 pipeline 脚本")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[s._v("node")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"webserver"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n   stage"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'git checkout'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n       checkout"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$class")]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'GitSCM'")]),s._v(", branches: "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("name: "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'*/master'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(", doGenerateSubmoduleConfigurations: false, extensions: "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(", submoduleCfg: "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(", userRemoteConfigs: "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("credentialsId: "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'8e8e63f9-4806-4f2e-8633-c92badbdefd7'")]),s._v(", url: "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"git@192.168.20.131:/home/git/repos/'),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${JOB_NAME}")]),s._v('.git"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n   "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n   stage"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'maven build'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sh")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("''")]),s._v("'export "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("JAVA_HOME")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/usr/java/jdk1.8.0_211\n        /usr/bin/mvn clean package"),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("''")]),s._v("'\n   "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n   stage"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'deploy'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sh")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("''")]),s._v("'\n        "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("JENKINS_NODE_COOKIE")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("dontkillme\n        "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("JAVA_HOME")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/usr/java/jdk1.8.0_211\n        "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("TOMCAT_NAME")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("tomcat\n        "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("TOMCAT_HOME")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/usr/local/"),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$TOMCAT_NAME")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("WWWROOT")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$TOMCAT_HOME")]),s._v("/webapps/ROOT\n\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" -d "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$WWWROOT")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("then")]),s._v("\n           "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("mv")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$WWWROOT")]),s._v(" /data/backup/"),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${TOMCAT_NAME}")]),s._v("-"),n("span",{pre:!0,attrs:{class:"token variable"}},[n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("date")]),s._v(" +"),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"%F_%T"')]),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("fi")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("unzip")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${WORKSPACE}")]),s._v("/target/*.war -d "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$WWWROOT")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("PID")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token variable"}},[n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("ps")]),s._v(" -ef "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" $TOMCAT_NAME "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("egrep")]),s._v(" -v "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"grep|'),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$$")]),s._v('"')]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("awk")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'{print $2}'")]),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" -n "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$PID")]),s._v('"')]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("kill")]),s._v(" -9 "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$PID")]),s._v("\n        /bin/bash "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$TOMCAT_HOME")]),s._v("/bin/startup.sh"),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("''")]),s._v("'\n   "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n   stage"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'test'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n       "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sh")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"curl http://www.de-java.com/status.html"')]),s._v("\n   "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br")])]),n("h2",{attrs:{id:"_12-jenkins-docker-实现持续集成"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_12-jenkins-docker-实现持续集成"}},[s._v("#")]),s._v(" 12. Jenkins+Docker 实现持续集成")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[s._v("node")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"webserver"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n   stage"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Git Checkout'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        checkout"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$class")]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'GitSCM'")]),s._v(", branches: "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("name: "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'$Tag'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(", doGenerateSubmoduleConfigurations: false, extensions: "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(", submoduleCfg: "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(", userRemoteConfigs: "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("url: "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'git@192.168.0.219:/home/git/solo.git'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n   "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n   stage"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Maven Build'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sh")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("''")]),s._v("'\n        "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("JAVA_HOME")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/usr/local/jdk1.8\n        /usr/local/maven3.5/bin/mvn clean package -Dmaven.test.skip"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("true\n        "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("''")]),s._v("'\n   "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n   stage"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Build and Push Image'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sh")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("''")]),s._v("'\n        "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("REPOSITORY")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".0.2/project/dev-docker:"),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${Tag}")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" Dockerfile "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<")]),s._v(" EOF\n        FROM "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".0.2/library/tomcat-85:latest\n        RUN "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" -rf /usr/local/tomcat/webapps/ROOT\n        COPY target/*.war /usr/local/tomcat/webapps/ROOT.war\n        CMD "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"catalina.sh"')]),s._v(", "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"run"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n        EOF\n        "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" build -t "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$REPOSITORY")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" login -u zhangrenyang -p "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("xxx")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".0.2\n        "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" push "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$REPOSITORY")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("''")]),s._v("'\n   "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n   stage"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Deploy to Docker'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sh")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("''")]),s._v("'\n        "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("REPOSITORY")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".0.219/project/dev-docker:"),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${Tag}")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" -f dev-docker: "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),n("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" image "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$REPOSITORY")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),n("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" login -u zhangrenyang -p "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("xxx")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".0.2\n        "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" container run -d --name dev-docker -v /usr/local/jdk1.8:/usr/local/jdk -p "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("88")]),s._v(":8080 "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$REPOSITORY")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("''")]),s._v("'\n   "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br")])])])}),[],!1,null,null,null);a.default=e.exports}}]);